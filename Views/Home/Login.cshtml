@model EMMS.Models.Admin.User
@using EMMS.Utility;
@using static EMMS.Models.Enumerators;
@using Newtonsoft.Json;

@{
    Layout = "_FullScreenLayout";
}

<div class="container">
    <div class="d-flex justify-content-center align-content-center">
        <div class="card col-md-12 col-lg-6 col-xl-6 mb-6">
            <div class="card-body">
                <!-- Success Notification -->
                @if (TempData["UserRegistrationSuccess"] != null && (bool)TempData["UserRegistrationSuccess"])
                {
                    <div class="alert alert-success alert-dismissible fade show d-flex align-items-center w-100 mb-3"
                         role="alert" id="successNotification">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        <div>User registration was successful! You can now login with your credentials.</div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <!-- Error Notification -->
                @if (TempData["Notification"] != null)
                {
                    var toast = JsonConvert.DeserializeObject<ToastNotification>(TempData["Notification"].ToString());
                    <div class="alert alert-@(toast.Type == NotificationType.Error ? "danger" : "success") alert-dismissible fade show d-flex align-items-center w-100 mb-3"
                         role="alert">
                        <i class="bi @(toast.Type == NotificationType.Error ? "bi-exclamation-triangle-fill" : "bi-check-circle-fill") me-2"></i>
                        <div>@toast.Message</div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <main class="container py-5" style="background-color: white;">
                    <div class="row justify-content-center">
                        <div class="col-md-12 col-lg-12">

                            <!-- Logo -->
                            <div class="text-center mb-3">
                                <div class="logo-container">
                                    <img src="~/images/Coat_of_arms_of_Eswatini.svg"
                                         alt="Ministry Coat of Arms"
                                         style="width: 70px; height: 70px;">
                                </div>
                            </div>

                            <!-- System Title -->
                            <div class="text-center mb-4">
                                <h4 class="system-title">Equipment Management & Maintenance System</h4>
                                <p class="text-muted small mb-0">Kingdom of Eswatini</p>
                            </div>

                            <!-- Login Card -->
                            <div class="card shadow-sm border-0">
                                <div class="card-body p-4">
                                    <form asp-action="Login" method="post">
                                        <!-- Username -->
                                        <div class="mb-3">
                                            <label for="username" class="form-label">Username</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="username"
                                                   name="username"
                                                   required
                                                   placeholder="Enter your username">
                                            <div class="text-danger small mt-1" id="usernameError"></div>
                                        </div>

                                        <!-- Password -->
                                        <div class="mb-3">
                                            <label for="password" class="form-label">Password</label>
                                            <div class="input-group">
                                                <input type="password"
                                                       class="form-control"
                                                       id="password"
                                                       name="password"
                                                       required
                                                       placeholder="Enter your password">
                                                <button class="btn btn-outline-secondary"
                                                        type="button"
                                                        id="togglePassword">
                                                    <i class="fas fa-eye" id="toggleIcon"></i>
                                                </button>
                                            </div>
                                            <div class="text-danger small mt-1" id="passwordError"></div>
                                        </div>

                                        <!-- Login Button -->
                                        <div class="d-grid mb-3">
                                            <button type="submit" class="btn btn-primary fw-bold" id="loginBtn">
                                                Login
                                            </button>
                                        </div>

                                        <!-- Register / Forgot -->
                                        <div class="d-flex justify-content-between">
                                            <a asp-action="UserRegistration" class="small text-decoration-none">Register new account</a>
                                            <a href="#" class="small text-decoration-none">Forgot Password?</a>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>
</div>



@section Scripts{
    <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Password toggle functionality (matching your existing code)
                    const togglePassword = document.getElementById('togglePassword');
                    const passwordInput = document.getElementById('password');
                    const toggleIcon = document.getElementById('toggleIcon');

                    togglePassword.addEventListener('click', function() {
                        const isPassword = passwordInput.type === 'password';
                        passwordInput.type = isPassword ? 'text' : 'password';

                        if (isPassword) {
                            toggleIcon.classList.remove('fa-eye');
                            toggleIcon.classList.add('fa-eye-slash');
                        } else {
                            toggleIcon.classList.remove('fa-eye-slash');
                            toggleIcon.classList.add('fa-eye');
                        }
                    });

                    // Simple form validation
                    const loginForm = document.getElementById('loginForm');
                    const loginBtn = document.getElementById('loginBtn');

                    loginForm.addEventListener('submit', function(e) {
                        e.preventDefault();

                        // Clear previous errors
                        document.getElementById('usernameError').textContent = '';
                        document.getElementById('passwordError').textContent = '';

                        const username = document.getElementById('username').value.trim();
                        const password = document.getElementById('password').value;

                        let hasErrors = false;

                        if (!username) {
                            document.getElementById('usernameError').textContent = 'Username is required';
                            hasErrors = true;
                        }

                        if (!password) {
                            document.getElementById('passwordError').textContent = 'Password is required';
                            hasErrors = true;
                        }

                        if (!hasErrors) {
                            // Show loading state
                            loginBtn.classList.add('btn-loading');
                            loginBtn.disabled = true;

                            // Simulate form submission (replace with your actual form submission)
                            setTimeout(() => {
                                loginBtn.classList.remove('btn-loading');
                                loginBtn.disabled = false;
                                alert('Login form would be submitted here');
                            }, 1500);
                        }
                    });

                    // Show success notification (simulated - replace with your TempData check)
                    const urlParams = new URLSearchParams(window.location.search);
                    if (urlParams.get('registered') === 'true') {
                        const notification = document.getElementById('successNotification');
                        notification.style.display = 'flex';
                    }
                });
                </script>
}
