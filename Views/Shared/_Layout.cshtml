@using EMMS.Models
@using EMMS.Models.Admin
@{

    var isAdmin = ViewBag._currrentUserRole.UserType == Enumerators.UserType.Administrator;
    var isBiomed = ViewBag._currrentUserRole.UserType == Enumerators.UserType.Biomed;
	var currentUser = ViewBag._currentUser as User;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - EMMS</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /><!-- Bootstrap-Select CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap-selectpicker/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.min.css" />
    @* <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" /> *@
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/DataTables/datatables.min.css" />
    @* <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.dataTables.css" /> *@
    <link rel="stylesheet" href="~/css/notification.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/EMMS.styles.css" asp-append-version="true" />
</head>
<body>
    <div class="container-fluid h-full w-full" style="height: 100vh;">
        <div class="row flex-nowrap" style="height: 100vh;">
            <div class="col-auto px-0 py-0 h-full" style="height: 100vh;">
                <div id="sidebar" class="collapse collapse-horizontal">
                    <nav class="navbar d-flex align-items-center" style="background-color: #2563EB;">
                        <div class="container-fluid justify-content-start">
                            <a class="align-items-center float-start py-1" href="#">
                                @* <img src="~/images/Coat_of_arms_of_Eswatini.svg" alt="MOH" width="30" height="25" class="me-2"> *@
                                <span class="fw-bold text-white" style="font-size: larger;">
                                    EMMS
                                </span>
                            </a>
                        </div>
                    </nav>
                    <div id="sidebar-nav" class="list-group border-0 rounded-0 rounded-0 text-sm-start" style="border: none;">
                        <a asp-controller="Home" asp-action="Index" class="@ViewData["active"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><i class="fa-solid fa-gauge"></i> <span>Dashboard</span> </a>
                        <a asp-controller="AssetManagement" asp-action="Index" class="@ViewData["asset"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><i class="fa-solid fa-box-open"></i> <span>Asset Management</span></a>
                        <a style="color:black" href="#movementmenu" data-bs-toggle="collapse" class="@ViewData["JobMovement"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar">
                            <i class="fa-solid fa-arrows-turn-to-dots"></i> <span>Asset Movement</span>
                        </a>
                        <div style="border:solid; border-color:gray;" id="movementmenu" class="collapse list-group border-1 rounded-0 text-sm-start">
                            <a style="font-size:0.8rem;font-weight:600;" asp-controller="AssetMovement" asp-action="Index" class="@ViewData["moveAsset"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><span>Move Asset</span></a>
                            <a style="font-size:0.8rem;font-weight:600;" asp-controller="AssetMovement" asp-action="recieveAsset" class="@ViewData["recieveAsset"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><span>Receive Asset</span></a>
                        </div>
                        <a style="color:black" href="#jobmenu" data-bs-toggle="collapse" class="@ViewData["JobManagement"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar">
                            <i class="fa-solid fa-toolbox"></i> <span>Job Management</span>
                        </a>
                        <div style="border:solid; border-color:gray;" id="jobmenu" class="collapse list-group border-1 rounded-0 text-sm-start">
                            <a style="font-size:0.8rem;font-weight:600;" asp-controller="JobManagement" asp-action="Index" class="@ViewData["workRequest"] list-group-item item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><span>Work Request</span></a>
                            @if (isBiomed || isAdmin)
                            {
                                <a style="font-size:0.8rem;font-weight:600;" asp-controller="JobManagement" asp-action="manageJobs" class="@ViewData["manageJob"] list-group-item item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><span>Create Job</span></a>                                
                            }
                        </div>

                        <a asp-controller="Notification" asp-action="Index" class="@ViewData["Notification"] list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar"><i class="fa-solid fa-bell"></i> <span>Notifications</span></a>
                        @if (isAdmin)
                        {
                            <a asp-controller="Admin" asp-action="LookupList" class="list-group-item border-0 d-inline-block text-truncate">
                                <i class="fa-solid fa-list"></i> <span>Lookup List</span>
                            </a>

                            <a style="color:black" href="#usermenu" data-bs-toggle="collapse" class="list-group-item border-0 d-inline-block text-truncate" data-bs-parent="#sidebar">
                                <i class="fa-solid fa-toolbox"></i> <span>User Management</span>
                            </a>

                            <div style="border:solid; border-color:gray;" id="usermenu" class="collapse list-group border-1 rounded-0 text-sm-start">
                                <a style="font-size:0.8rem;font-weight:600;" asp-controller="Users" asp-action="Index" class="list-group-item item border-0 d-inline-block text-truncate"><span>User Accounts</span></a>
                                <a style="font-size:0.8rem;font-weight:600;" asp-controller="Admin" asp-action="UserRoles" class="list-group-item item border-0 d-inline-block text-truncate"><span>User Roles</span></a>
                            </div>
                        }


                        @* @await Component.InvokeAsync("SidebarLookups") *@
                    </div>
                </div>
            </div>
            <main class="col px-0 py-0 mb-5">
                <nav class="navbar sticky-top d-flex align-items-center" style="background-color: #2563EB;">
                    <div class="container-fluid d-flex items-center">
                        <div class="d-flex align-items-center">
                            <a href="#" data-bs-target="#sidebar" data-bs-toggle="collapse" class="border rounded-3 p-1 text-decoration-none me-2 menu-toggle">
                                <i class="fa-solid fa-bars"></i>
                            </a>
                            <span class="fw-bold text-white" style="font-size: smaller;">
                                @(currentUser!.Facility?.FacilityName)
                            </span>
                        </div>
                        <div class="d-flex align-items-center">
                            <a href="#" id="notificationBell" title="notification" class="border rounded-3 p-1 text-decoration-none me-2 menu-toggle" data-bs-toggle="popover" data-bs-html="true">
                                <i class="fa-solid fa-bell"></i><span class="badge bg-danger rounded-pill" style="font-size:xx-small">2</span>
                            </a>
                            <a asp-controller="Home" asp-action="Logout" title="Logout" class="border rounded-3 p-1 text-decoration-none me-2 menu-toggle">
                                <i class="fa-solid fa-power-off"></i>
                            </a>
                            <div class="row justify-content-center align-items-center">
                                <div class="col-auto" style="padding-right:0px;">
                                    <img src="~/images/user.jpg"
                                         class="rounded-circle"
                                         style="width: 30px; height: 30px; object-fit: cover; border: 2px solid #dee2e6; padding: 2px;"
                                         alt="User Image" />
                                </div>
                                <div class="col-auto d-none d-md-block">
                                    <div class="d-flex flex-column">
                                        <span class="fw-bold" style="font-size:smaller">
                                            @(currentUser!.FirstName) @(currentUser.LastName)
                                        </span>
                                        <span class="text-muted" style="font-size:x-small">
                                            @currentUser.UserRole!.Name
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </nav>
                <!-- Notification popover template (hidden) -->
                <div id="notificationTemplate" style="display: none;">
                    <div class="notification-header">
                        <h6 class="notification-title">Notifications</h6>
                        <span class="mark-all-read" id="markAllRead">Mark all as read</span>
                    </div>
                    <div class="notification-body">
                        <ul class="notification-list" id="notificationList">
                            <!-- Notifications will be populated here -->
							 @await Component.InvokeAsync("BellNotifications") 
                        </ul>
                        <div class="empty-notifications d-none" id="emptyNotifications">
                            <i class="fas fa-bell-slash fa-2x mb-3"></i>
                            <p>No notifications yet</p>
                        </div>
                    </div>
                    <div class="notification-footer">
                        <a asp-controller="Notification" asp-action="Index">View all notifications</a>
                    </div>
                </div>

                <div class="container-fluid p-4 mb-2">
                    @RenderBody()
                </div>

               
            </main>
        </div>
    </div>

    <div class="footer border-top-1" style="background-color:#F5F5F5">
        <div class="d-flex justify-content-between align-items-center">
            <img src="~/lib/coa.jpeg" alt="MOH" width="30" height="24" class="float-start ms-1">
            <span class="text-muted text-center mx-auto py-0">© 2025 EMMS. All rights reserved.</span>
            <img src="~/lib/HMIS.jpg" alt="HIMS" width="30" height="24" class="float-end me-1">
        </div>
    </div>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script><!-- Bootstrap-Select JS (after Bootstrap JS) -->
    <script src="~/lib/bootstrap-selectpicker/js/bootstrap-select.min.js"></script>
    <script src="~/lib/DataTables/datatables.min.js"></script>
    <script src="~/js/xlsx.full.min.js" asp-append-version="true"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/notification.js" asp-append-version="true"></script>
    <script>
        // if screen onresize is below 700 hide side bar by default
        document.addEventListener("DOMContentLoaded", function () {
            const sidebar = document.getElementById("sidebar");

            function toggleSidebar() {
                if (window.innerWidth < 769) {
                    sidebar.classList.remove("show"); // Hide the sidebar
                } else {
                    sidebar.classList.add("show"); // Show the sidebar
                }
            }

            // Run on page load
            toggleSidebar();

            // Run on window resize
            window.addEventListener("resize", toggleSidebar);
        });

                document.addEventListener("DOMContentLoaded", function () {
            const descriptionModal = document.getElementById("descriptionModal");
            const fullDescription = document.getElementById("fullDescription");

            descriptionModal.addEventListener("show.bs.modal", function (event) {
                const button = event.relatedTarget; // Button that triggered the modal
                const description = button.getAttribute("data-description"); // Extract info from data-* attributes
                fullDescription.textContent = description; // Update the modal's content
            });
        });
                $(function () {
            $('.selectpicker').selectpicker();
        });

    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
<div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="descriptionModalLabel">Full Description</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="fullDescription"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
